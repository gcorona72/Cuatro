<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Guest Management con Supabase</title>
</head>
<body>
<h1>Gestión de Invitados</h1>

<!-- Botón para cargar invitados -->
<button onclick="loadGuests()">Cargar Invitados</button>
<ul id="guestList"></ul>

<hr/>
<h2>Agregar Invitado</h2>
<form id="addForm">
  <label>Nombre:</label>
  <input type="text" id="name" required>
  <br/>

  <label>Email:</label>
  <input type="email" id="email" required>
  <br/>

  <label>Teléfono:</label>
  <input type="text" id="phone">
  <br/>

  <label>RSVP:</label>
  <input type="text" id="rsvp">
  <br/>

  <label>Plus One:</label>
  <input type="checkbox" id="plus_one">
  <br/>

  <label>Notas:</label>
  <input type="text" id="notes">
  <br/>

  <button type="submit">Agregar Invitado</button>
</form>

<hr/>
<h2>Actualizar Invitado</h2>
<form id="updateForm">
  <label>ID:</label>
  <input type="number" id="updateId" required>
  <br/>

  <label>Nombre:</label>
  <input type="text" id="updateName">
  <br/>

  <label>Email:</label>
  <input type="email" id="updateEmail">
  <br/>

  <label>Teléfono:</label>
  <input type="text" id="updatePhone">
  <br/>

  <label>RSVP:</label>
  <input type="text" id="updateRsvp">
  <br/>

  <label>Plus One:</label>
  <input type="checkbox" id="updatePlusOne">
  <br/>

  <label>Notas:</label>
  <input type="text" id="updateNotes">
  <br/>

  <button type="submit">Actualizar Invitado</button>
</form>

<hr/>
<h2>Eliminar Invitado</h2>
<form id="deleteForm">
  <label>ID:</label>
  <input type="number" id="deleteId" required>
  <button type="submit">Eliminar</button>
</form>

<!-- Importa el Supabase JS SDK directamente desde un CDN -->
<script type="module">
  import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

  // Credenciales de tu proyecto en Supabase
  const supabaseUrl = 'https://ndapktzfypmgnlqhtxcy.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kYXBrdHpmeXBtZ25scWh0eGN5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDEwOTczNjYsImV4cCI6MjA1NjY3MzM2Nn0.8fJgmOpKZiWQdDVx7Y-e6NvKPw8vVpUiLT1w4qb0HE8';
  const supabase = createClient(supabaseUrl, supabaseKey);

  // Cargar invitados
  async function loadGuests() {
    const { data, error } = await supabase
            .from('guests')
            .select('*');
    if (error) {
      console.error('Error al cargar invitados:', error);
      return;
    }
    const list = document.getElementById('guestList');
    list.innerHTML = '';
    data.forEach(guest => {
      const li = document.createElement('li');
      li.textContent = `[${guest.id}] ${guest.name} - ${guest.email} - RSVP: ${guest.rsvp_status}`;
      list.appendChild(li);
    });
  }

  // Agregar invitado
  document.getElementById('addForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const newGuest = {
      name: document.getElementById('name').value,
      email: document.getElementById('email').value,
      phone: document.getElementById('phone').value,
      rsvp_status: document.getElementById('rsvp').value,
      plus_one: document.getElementById('plus_one').checked,
      notes: document.getElementById('notes').value
    };
    const { error } = await supabase
            .from('guests')
            .insert(newGuest);
    if (error) {
      console.error('Error al agregar invitado:', error);
      alert('Error al agregar invitado.');
    } else {
      alert('Invitado agregado correctamente.');
      loadGuests();
    }
  });

  // Actualizar invitado
  document.getElementById('updateForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = Number(document.getElementById('updateId').value);
    const updatedGuest = {
      name: document.getElementById('updateName').value,
      email: document.getElementById('updateEmail').value,
      phone: document.getElementById('updatePhone').value,
      rsvp_status: document.getElementById('updateRsvp').value,
      plus_one: document.getElementById('updatePlusOne').checked,
      notes: document.getElementById('updateNotes').value
    };
    const { error } = await supabase
            .from('guests')
            .update(updatedGuest)
            .eq('id', id);
    if (error) {
      console.error('Error al actualizar invitado:', error);
      alert('Error al actualizar invitado.');
    } else {
      alert('Invitado actualizado correctamente.');
      loadGuests();
    }
  });

  // Eliminar invitado
  document.getElementById('deleteForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    const id = Number(document.getElementById('deleteId').value);
    const { error } = await supabase
            .from('guests')
            .delete()
            .eq('id', id);
    if (error) {
      console.error('Error al eliminar invitado:', error);
      alert('Error al eliminar invitado.');
    } else {
      alert('Invitado eliminado correctamente.');
      loadGuests();
    }
  });

  // Carga inicial de invitados
  loadGuests();
</script>
</body>
</html>
